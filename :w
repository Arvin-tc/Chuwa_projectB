import React, { useEffect } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { fetchVisaStatus, uploadVisaDoc } from '../redux/slices/visaStatusSlice';

const VisaStatus = () => {
    const dispatch = useDispatch();
    const { visaDocuments, loading, error } = useSelector((state) => state.visa);

    useEffect(() => {
        dispatch(fetchVisaStatus());
    }, [dispatch]);

    const handleUpload = (documentType, file) => {
        dispatch(uploadVisaDoc({ documentType, file }));
    };

    const renderStatusMessage = (document) => {
        if (document.status === 'Pending') {
            return <p>Waiting for HR to approve your {document.type}.</p>;
        }
        if (document.status === 'Approved') {
            return <p>Please upload the next document.</p>;
        }
        if (document.status === 'Rejected') {
            return <p>Rejected: {document.feedback}</p>;
        }
        return null;
    };

    if (loading) return <p>Loading...</p>;
    if (error) return <p>Error: {error}</p>;

    return (
        <div className="container mx-auto p-6">
            <h1 className="text-2xl font-bold mb-6">Visa Status Management</h1>
            <div className="bg-white p-6 rounded-md shadow-md space-y-6">
                {Object.keys(visaDocuments).map((key) => (
                    <div key={key}>
                        <h2 className="font-bold text-lg">{key.replace(/([A-Z])/g, ' $1')}</h2>
                        {renderStatusMessage(visaDocuments[key])}
                        {visaDocuments[key].status === 'Approved' && (
                            <input
                                type="file"
                                onChange={(e) => handleUpload(key, e.target.files[0])}
                            />
                        )}
                    </div>
                ))}
            </div>
        </div>
    );
};

export default VisaStatus;
